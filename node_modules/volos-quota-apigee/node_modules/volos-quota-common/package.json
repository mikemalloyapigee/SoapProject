{
  "name": "volos-quota-common",
  "version": "0.10.1",
  "main": "lib/quota.js",
  "license": "MIT",
  "description": "Common library for Quota enforcement in the Volos system.",
  "homepage": "https://github.com/apigee/volos",
  "keywords": [
    "quota",
    "memory"
  ],
  "dependencies": {
    "debug": "1.0.x",
    "underscore": "1.6.x"
  },
  "devDependencies": {},
  "repository": {
    "type": "git",
    "url": "https://github.com/apigee/volos.git"
  },
  "readme": "# volos-quota-common\n\nThis module adds support for \"quotas\" to any API.\n\nA quota is a traffic-management construct that is often used in building APIs and presenting them to\ndevelopers. It is common in the API world to offer a service that is available to each individual application\nfor a limited number of requests per hour, day, or week.\n\nFor instance, the developers of an API may wish to identify each application that uses the API using an \"API key\"\nand offer different levels of service  based on the application. For instance, some applications might be allowed\nto make only 100 API calls per hour, while others might have a much higher limit.\n\nThis module may be used to do that. Using it, you create a \"quota,\" and each quota has the following attributes:\n\n* timeUnit: How often the quota resets -- may be in minutes, hours, days, or weeks\n* interval: Works with the timeUnit to determine how often the quota resets. For instance, every 5 days or 2 weeks.\n* startTime: A time at which the quota calculations should begin. For instance, if there is no start time then a\nquota set to reset in \"one day\" will reset 24 hours after the first message is receiver, but if the start time\nis set to the top of the hour on some day, then the quota will always reset at the top of the hour.\n\nOnce a quota has been created, you \"apply\" the quota, which involves setting some additional attributes:\n\n* weight: How much to add to the quota -- the default is 1, but in some advanced cases, API providers will\nassign different weights to different API calls.\n* allow: How many requests to allow. By specifying this here, rather than when the quota is created,\nwe can have different quotas for different apps.\n* key: Identifies the quota bucket. This is a string that may be set to any value. Each key locates\na single quota bucket, which has a separate counter value from other counters.\n\n## Modules\n\nThis module does not do anything on its own -- it depends on an implementation which stores the quota in a particular\nplace. Currently the options are:\n\n* volos-quota-local: Stores quotas in memory on the node where the script is running\n* volos-quota-apigee: Communicates with Apigee via API to update and check quota results.\n\n## Example\n\n    var apiKey = // Some string that comes from the incoming API call\n    var qm = require('volos-quota-apigee');\n    var quota = qm.createQuota({ timeUnit: 'day', interval: 1 });\n    // Allow 100 requests per day for each application, based on API key\n    quota.apply({ key: apiKey, allow: 100 });\n\n## Reference\n\n### Class: Quota\n\n#### Quota.apply(options, callback)\n\nApply the quota and invoke \"callback\" with a result. Options can have the following parameters:\n\n* key (required): A string that identifies the quota bucket. Quotas with different keys\nare treated as separate quotas.\n* weight (optional): A number that indicates how much to increment the quota counter by. Default is 1.\n* allow (optional): How much to allow this quota before it is used up. If this is not specified here,\nthen the value of \"allow\" that was specified when the quota object was created is used.\n\nThe result of this call is delivered by calling \"callback.\" If there was an error, then the first parameter\nwill be an Error object. Otherwise, the first parameter will be \"undefined\" and the second will be\nan object that contains the following fields:\n\n* allowed: (number) How much is allowed in the quota bucket. Essentially the same as the \"allow\" parameter that is\npassed to the \"apply\" method, or the default that came from the overall object.\n* used: (number) How much of the quota bucket is used up.\n* isAllowed: (boolean) Whether the quota bucket has been used up. Basically the same as checking whether\n\"used > allowed\".\n* expiryTime: (number) The number of milliseconds until the quota bucket \"used\" amount is reset to zero.\n\n### Middleware\n\n#### Middleware.apply(options)\n\nApplies quota and returns (403) error on exceeded.\n\nAutomatically sets the following headers on the response: \n\n* X-RateLimit-Limit\n* X-RateLimit-Remaining\n* X-RateLimit-Reset\n\nOptions (optional) may contain:\n\n* key (optional) may be a string or a function that takes the request and generates a string id.\n    if not specified, id will default to the request originalUrl\n* weight (optional) may be a number or a function that takes the request and generates a number\n\n#### Middleware.applyPerAddress(options)\n\nApplies quota on a per-caller address basis and returns (403) error on exceeded.\n\nOptions (optional) may contain:\n\n* key (optional) may be a string or a function that takes the request and generates a string id.\n    if not specified, id will default to the request originalUrl\n* weight (optional) may be a number or a function that takes the request and generates a number\n\n#### Middleware usage examples: \n\n##### Quota.connectMiddleware()\n\nReturns middleware that may be used in a Connect server.\n\n```\n   server.get('/',\n     quota.connectMiddleware().apply(),\n     ...\n```\n \n##### Quota.expressMiddleware()\n\nReturns middleware that may be used in a Express server. \n\n```\n   server.get('/',\n     quota.expressMiddleware().apply(),\n     ...\n```\n\n##### Quota.argoMiddleware()\n\nReturns middleware that may be used in an Argo server. \n\n```\n    server.get('/', function(handle) {\n      handle('request', function(env, next) {\n        oauth.argoMiddleware().apply(env, function() {\n        ...\n```",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/apigee/volos/issues"
  },
  "_id": "volos-quota-common@0.10.1",
  "_from": "volos-quota-common@0.10.x",
  "scripts": {}
}
